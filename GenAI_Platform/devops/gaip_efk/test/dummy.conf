[SERVICE]
    Parsers_File ./parsers.conf

[INPUT]
    Name dummy
    Tag  kube.A
    Dummy {"log":"[resource/jonathan_usage] {\"message\": \"Hi\", \"test\": \"123\"}", "others": "data", "stream": "stdout", "kubernetes": {"annotations": {"acryl.ai/appType": "system"}}}

[FILTER]
    Name    lua
    Match   kube.*
    Script  ./jfb.lua
    Call    category_major_minor

[FILTER]
    Name            rewrite_tag
    Match           kube.*
    Rule            $_cat_minor  ^(?!user$)  nonuser.$TAG  false

[FILTER]
    Name            parser
    Match           nonuser.kube.*
    Key_Name        log
    Parser          jfb-extract-level
    Preserve_Key    On
    Reserve_Data    On

[FILTER]
    Name            parser
    Match           nonuser.kube.*
    Key_Name        log
    Parser          resource-extract-level
    Preserve_Key    On
    Reserve_Data    On

[FILTER]
    Name        lua
    Match_Regex nonuser.kube.*
    Script      ./jfb.lua
    Call        level_confirm

[FILTER]
    Name            rewrite_tag
    Match           nonuser.kube.*
    Rule            $_cat_minor  ^(usage|resource)$  json.$TAG  false

[FILTER]
    Name            parser
    Match           json.nonuser.kube.*
    Key_Name        jfb_log
    Parser          training-json
    Preserve_Key    On
    Reserve_Data    On

[FILTER]
    Name    lua
    Match   *kube.*
    Script  ./jfb.lua
    Call    congregate_index

# [FILTER]
#     Name        rewrite_tag
#     Match       dummy.*
#     Rule        log ^\[FLIGHTBASE\] training.$TAG true

# [FILTER]
#     Name        parser 
#     Match       training.*
#     Key_Name    log
#     Parser      jfb-remove-training-header
#     Preserve_Key Off
#     Reserve_Data On

# [FILTER]
#     Name    nest
#     Match   training.*
#     Operation   nest
#     Wildcard    log
#     Nested_under  user_items

# [FILTER]
#     Name        parser 
#     Match       training.*
#     Key_Name    log
#     Parser      training-json
#     Preserve_Key Off
#     Reserve_Data On

#[FILTER]
#    Name              multiline
#    Match             dummy.*
#    multiline.key_content   log
#    multiline.parser        multiline-custom

# [FILTER]
#     Name            parser
#     Match_Regex     dummy\.(data|system)
#     Key_Name        log
#     Parser          jfb_extract_level
#     Preserve_Key    Off
#     Reserve_Data    On

[OUTPUT]
    Name stdout
    Match *