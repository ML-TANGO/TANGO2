# Inference Monitoring Stack (Prometheus + Grafana)

**AI Inference ì„œë²„ì˜ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**ì„ ìœ„í•œ ê¸°ë³¸ ìŠ¤íƒ êµ¬ì„± ì˜ˆì‹œë¥¼ ì œê³µí•©ë‹ˆë‹¤.  
`Prometheus`ê°€ ì„œë²„ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ê³ , `Grafana`ê°€ ì´ë¥¼ ì‹œê°í™”í•˜ì—¬ ì¸í¼ëŸ°ìŠ¤ íŒŒì´í”„ë¼ì¸ì˜ ì„±ëŠ¥ì„ í•œëˆˆì— íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ“¦ êµ¬ì„± ê°œìš”

### 1. Prometheus
- **ì—­í• :**  
  ë©”íŠ¸ë¦­ ìˆ˜ì§‘ê¸°.  
  ì¸í¼ëŸ°ìŠ¤ ì„œë²„(Triton Inference Server ë“±) ë˜ëŠ” ê´€ë ¨ Exporter(Node, DCGM ë“±)ì—ì„œ ë°ì´í„°ë¥¼ ìŠ¤í¬ë ˆì´í”„(Scrape)í•©ë‹ˆë‹¤.

- **ì£¼ìš” ê¸°ëŠ¥:**  
  - GPU/CPU ì‚¬ìš©ë¥ , ì „ë ¥ ì‚¬ìš©ëŸ‰
  - ê° ëª¨ë¸ë³„ ì¶”ë¡  ì§€ì—°(latency), í ëŒ€ê¸° ì‹œê°„, I/O ì§€ì—° ë“±

- **ì„¤ì • íŒŒì¼:** `prometheus/prometheus.yml`
  - `scrape_configs` í•­ëª©ì˜ `targets`ì—ì„œ **í˜¸ìŠ¤íŠ¸ ì£¼ì†Œ ë˜ëŠ” ì»¨í…Œì´ë„ˆ ì£¼ì†Œ**ë¥¼ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.

  ```yaml
  scrape_configs:
    - job_name: 'triton'
      static_configs:
        - targets: ['<YOUR_HOST_IP>:8002']   # Triton metrics endpoint
  ```

  > ì˜ˆë¥¼ ë“¤ì–´ Triton ì„œë²„ê°€ í˜¸ìŠ¤íŠ¸ì—ì„œ 8002 í¬íŠ¸ë¥¼ í†µí•´ ë…¸ì¶œëœë‹¤ë©´  
  > `targets: ['host.docker.internal:8002']` ë˜ëŠ” ì‹¤ì œ IPë¡œ ë³€ê²½í•˜ì‹­ì‹œì˜¤.

---

### 2. Grafana
- **ì—­í• :**  
  Prometheusê°€ ìˆ˜ì§‘í•œ ë©”íŠ¸ë¦­ì„ ì‹œê°í™”í•˜ëŠ” ëŒ€ì‹œë³´ë“œ ì„œë²„ì…ë‹ˆë‹¤.

- **ëŒ€ì‹œë³´ë“œ:**  
  `/grafana/provisioning/dashboards/boards/triton.json`  
  ì´ JSON íŒŒì¼ì€ Triton ê¸°ë°˜ ì¸í¼ëŸ°ìŠ¤ í™˜ê²½ì— íŠ¹í™”ëœ ì»¤ìŠ¤í…€ ëŒ€ì‹œë³´ë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.

- **í‘œì‹œë˜ëŠ” ì£¼ìš” í•­ëª©**
  | êµ¬ë¶„ | ì„¤ëª… |
  |------|------|
  | **Preprocessing Compute Latency** | ì „ì²˜ë¦¬ ë‹¨ê³„ ì—°ì‚° ì§€ì—° |
  | **Inference Compute Latency** | ëª¨ë¸ ì¶”ë¡  ë‹¨ê³„ ì§€ì—° |
  | **Postprocessing Compute Latency** | í›„ì²˜ë¦¬ ë‹¨ê³„ ì—°ì‚° ì§€ì—° |
  | **Input / Output Latency** | ì…ì¶œë ¥ ë‹¨ê³„ë³„ ì§€ì—° |
  | **Queue Delay** | ìš”ì²­ ëŒ€ê¸° ì‹œê°„ |
  | **E2E Request Latency** | ì „ì²´ ìš”ì²­-ì‘ë‹µ ì§€ì—° |
  | **CPU Usage / GPU Usage** | ì‹œìŠ¤í…œ ìì› ì‚¬ìš©ëŸ‰ (DCGM, Node Exporter ë“± ê¸°ë°˜) |

---

## âš™ï¸ ì‚¬ìš© ë°©ë²•

### 1. ì˜ì¡´ì„±
- Docker (ë˜ëŠ” nerdctl)
- Docker Compose v2 ì´ìƒ

### 2. ì‹¤í–‰
```bash
docker compose up -d
```
ë˜ëŠ” containerd í™˜ê²½ì—ì„œëŠ”:
```bash
nerdctl compose up -d
```

ê¸°ë³¸ í¬íŠ¸:
- Grafana â†’ [`http://localhost:3000`](http://localhost:3000)
- Prometheus â†’ [`http://localhost:9090`](http://localhost:9090)

### 3. Grafana ì ‘ì† ë° ë¡œê·¸ì¸
ì´ˆê¸° ID/PW: admin/admin
ë¡œê·¸ì¸ í›„ íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½ ê¶Œì¥

ì´í›„ ëŒ€ì‹œë³´ë“œë¥¼ í†µí•´ ì¸í¼ëŸ°ìŠ¤ ì„œë²„ì˜ í˜„í™© íŒŒì•… ê°€ëŠ¥
<p align="center">
  <img src="dashboard_example/example.png" alt="Inference Dashboard Example" width="800"/>
</p>

---

## ğŸ”§ ì„¤ì • ì»¤ìŠ¤í„°ë§ˆì´ì§•

### Prometheus
- `prometheus/prometheus.yml`ì—ì„œ **ìŠ¤í¬ë ˆì´í”„ ëŒ€ìƒ ìˆ˜ì •**
  (ì˜ˆ: Triton, Node exporter, DCGM exporter ë“±)
- `scrape_interval`, `evaluation_interval` ì¡°ì • ê°€ëŠ¥

### Grafana
- `grafana/provisioning/datasources/prometheus.yaml`
  Prometheus ì„œë²„ ì£¼ì†Œ ìˆ˜ì •:
  ```yaml
  url: http://prometheus:9090
  ```
  ì™¸ë¶€ Prometheusë¥¼ ì‚¬ìš©í•  ê²½ìš° ì‹¤ì œ ì£¼ì†Œë¡œ ë³€ê²½í•˜ì„¸ìš”.

- ëŒ€ì‹œë³´ë“œ ìë™ ë¡œë”©ì€ `grafana/provisioning/dashboards/dashboards.yaml`ì— ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ“Š ì˜ˆì‹œ ì•„í‚¤í…ì²˜

```
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚     Triton Inference Host    â”‚
                     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                     â”‚ â”‚  Exporters (DCGM / Node) â”‚ â”‚
                     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚  (HTTP /metrics)
                                    â”‚
                                    â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚          Prometheus          â”‚
                     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
                     â”‚  â€¢ scrape_targets ì„¤ì •       â”‚
                     â”‚  â€¢ ë©”íŠ¸ë¦­ ìˆ˜ì§‘               â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚            Grafana           â”‚
                     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
                     â”‚  â€¢ Prometheus ë°ì´í„° ì‹œê°í™”  â”‚
                     â”‚  â€¢ triton.json ëŒ€ì‹œë³´ë“œ ì œê³µ â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© ì£¼ìš” ë””ë ‰í„°ë¦¬ êµ¬ì¡°

```
.
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ prometheus/
â”‚   â””â”€â”€ prometheus.yml
â””â”€â”€ grafana/
    â””â”€â”€ provisioning/
        â”œâ”€â”€ datasources/
        â”‚   â””â”€â”€ prometheus.yaml
        â””â”€â”€ dashboards/
            â”œâ”€â”€ dashboards.yaml
            â””â”€â”€ boards/
                â””â”€â”€ triton.json
```

---

## ğŸ› ï¸ Troubleshooting

| ë¬¸ì œ | ì›ì¸ | í•´ê²° ë°©ë²• |
|------|------|------------|
| Grafana ëŒ€ì‹œë³´ë“œì— "No data" | Prometheusê°€ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ì§€ ëª»í•¨ | `prometheus.yml`ì˜ `targets` í™•ì¸ ë° Triton Metrics Endpoint ì ‘ê·¼ ê°€ëŠ¥ ì—¬ë¶€ ì ê²€ |
| ì¼ë¶€ íŒ¨ë„ì— ë¹¨ê°„ ê²½ê³  í‘œì‹œ | Grafana ë°ì´í„°ì†ŒìŠ¤ UID ë¶ˆì¼ì¹˜ | `datasources/prometheus.yaml`ì˜ UID ìˆ˜ì • ë˜ëŠ” JSONì—ì„œ ë³€ìˆ˜í™” |
| í¬íŠ¸ ì¶©ëŒ | ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì¤‘ | `docker ps`ë¡œ í™•ì¸ í›„ ì¤‘ë³µ ì»¨í…Œì´ë„ˆ ì¤‘ì§€ |

